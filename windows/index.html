<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, minimal-ui" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <meta name="msapplication-TileColor" content="#53749d" />
        <link href="style.css" rel="stylesheet">
        <title>##Orz 改名部</title>
    </head>
    <body>

        <header class="titlebar bar">
            <div id="back_button" class="icon titleitem barbutton" src="orz.gif"></div>
            <div class="title titleitem">##Orz 改名部</div>
        </header>
        <div class="container">
            <div>##Orz 分部喵 - daily.orz.chat -</div>
            <textarea id="newname_box" class="textbox" placeholder="New name" autofocus="autofocus">FIXME: original name should be here</textarea>
        </div>
        <div id="modal_wrap" class="modal_wrap invisible desc"></div>
        <footer id="footer" class="bar">
            <a id="submit_button" class="barbutton save_button" href="javascript:">&#xE105;<div class="desc invisible">保存</div></a>
            <div id="more_button" class="barbutton more_button">&#xE10C;</div>
        </footer>

        <script><!--
        footer_expanded = false;
            function goBack() {
                    history.back();
                    window.close();
                    setTimeout(function() {
                        window.open('tg:join?invite=A8eCpTuqXjqpZZefNH8Omg','_self');
                    }, 0.2);
            }
            function updateName(newName) {
                // TODO
                return confirm("[STUB] Change name to "+newName+"?");
            }
            function showPrompt(content, callback) {
                // FIXME
                alert(content);
                callback();
            }
            function toggleFooter() {
                footer_expanded = !footer_expanded;
                footer.classList.toggle("expand");
                [].forEach.call(document.getElementsByClassName("desc"), function (ele) {
                    ele.classList.toggle("invisible");
                });
                more_button.focus();
            }

            back_button.addEventListener("click", goBack);
            submit_button.addEventListener("click", function() {
                newname_box.disabled = true;
                submit_button.classList.add("disabled");
                back_button.classList.add("disabled");

                if(updateName(newname_box.value)) {
                    goBack();
                } else {
                    showPrompt("更新失败。", function() {
                        newname_box.disabled = false;
                        submit_button.classList.remove("disabled");
                        back_button.classList.remove("disabled");
                    });
                }
            });
            more_button.addEventListener("click", toggleFooter);
            modal_wrap.addEventListener("click", toggleFooter);
            window.addEventListener("blur", function() {
                if(footer_expanded) toggleFooter();
            })
        --></script>
    </body>
</html>
